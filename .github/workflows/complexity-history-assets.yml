name: Generate complexity history assets

on:
  workflow_dispatch:
    inputs:
      version:
        description: "Semantic version to record (for example, 0.38.0)."
        required: true
        type: string

jobs:
  build:
    name: Capture metrics and render chart
    runs-on: ubuntu-latest

    steps:
      - name: Check out repository
        uses: actions/checkout@v4

      - name: Install uv
        uses: astral-sh/setup-uv@v1

      - name: Sync dependencies
        run: uv sync --frozen --all-extras --dev

      - name: Capture complexity history
        run: >-
          uv run python scripts/update_complexity_history.py
          --version "${{ inputs.version }}"
          --chart-format svg
          --chart-format png

      - name: Upload complexity assets
        uses: actions/upload-artifact@v4
        with:
          name: complexity-history-assets
          path: |
            docs/complexity_history.md
            docs/complexity_history.csv
            docs/complexity_history.svg
            docs/complexity_history.png
          if-no-files-found: error
