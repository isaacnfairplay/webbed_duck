id = "traceability_barcode_summary"
path = "/demos/traceability/summary"
title = "Traceability summary"
description = "Resolve prefix-driven dependencies and merge traceability rows from nested local routes."
methods = ["GET"]
allowed_formats = ["json", "records", "arrow"]
default_format = "json"

[params]
[params.barcode]
type = "str"
required = true
description = "Barcode or prefix to investigate"

[params.prefix]
type = "str"
required = false
description = "Derived uppercase prefix inserted by the preprocessor"

[cache]
ttl_hours = 2
order_by = ["event_time", "table_route"]

[[preprocess]]
callable = "webbed_duck.demos.local_chaining_traceability:inject_prefix"

[[uses]]
alias = "prefix_lookup"
call = "traceability_prefix_map"
mode = "relation"

  [uses.args]
  prefix = "prefix"

[[uses]]
alias = "panel_events"
call = "traceability_panel_events"
mode = "relation"

  [uses.args]
  barcode = "barcode"

[[uses]]
alias = "module_events"
call = "traceability_module_events"
mode = "relation"

  [uses.args]
  barcode = "barcode"

[[uses]]
alias = "panel_file_hints"
call = "traceability_panel_file_hints"
mode = "relation"

  [uses.args]
  barcode = "barcode"

[[uses]]
alias = "module_file_hints"
call = "traceability_module_file_hints"
mode = "relation"

  [uses.args]
  barcode = "barcode"
